<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio Recorder</title>
</head>
<body>

<h2>Record & Translate Audio</h2>

<button id="startBtn">Start Recording</button>
<button id="stopBtn">Stop Recording</button>

<p><strong>Transcription:</strong></p>
<p id="transcription"></p>

<p><strong>Translation:</strong></p>
<p id="translation"></p>

<script>
let mediaRecorder;
let chunks = [];

document.getElementById("startBtn").onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();

    chunks = [];

    mediaRecorder.ondataavailable = e => {
        chunks.push(e.data);
    };
};

document.getElementById("stopBtn").onclick = async () => {
    mediaRecorder.stop();

    mediaRecorder.onstop = async () => {
        const blob = new Blob(chunks, { type: "audio/webm" });
        const formData = new FormData();
        formData.append("audio_file", blob, "audio.webm");

        const response = await fetch("/api/transcribe/", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        document.getElementById("transcription").innerText = data.transcription;
        document.getElementById("translation").innerText = data.translation;
    };
};
</script>

</body>
</html>
